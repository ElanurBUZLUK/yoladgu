<div class="container">
    <div class="quiz-container fade-in">
        <!-- Header -->
        <div class="quiz-header">
            <div class="quiz-info">
                <div class="subject-icon">üìê</div>
                <div class="quiz-details">
                    <h2>{{ currentQuestion?.subject || 'Matematik' }} - {{ currentQuestion?.topic || 'Trigonometri' }}</h2>
                    <p>AI √ñnerisi: {{ aiRecommendation }}</p>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn" (click)="goBack()">‚Üê Ana Sayfa</button>
                <button class="btn btn-danger" (click)="endQuiz()">Quiz'i Bitir</button>
            </div>
        </div>
        
        <!-- Progress Section -->
        <div class="progress-section">
            <app-progress-bar 
                [current]="currentQuestionIndex + 1"
                [total]="totalQuestions"
                [label]="'Soru ƒ∞lerlemesi'"
                [correctAnswers]="correctAnswers"
                [wrongAnswers]="wrongAnswers"
                [accuracy]="accuracyPercentage"
                [showDetails]="true">
            </app-progress-bar>
        </div>
        
        <!-- Timer -->
        <div class="timer-section">
            <app-timer 
                [label]="'Harcanan S√ºre'"
                (timeUpdate)="elapsedTime = $event">
            </app-timer>
        </div>
        
        <!-- Question Card -->
        <div class="question-card" *ngIf="currentQuestion">
            <div class="question-header">
                <div class="question-number">Soru {{ currentQuestionIndex + 1 }}</div>
                <app-difficulty-indicator 
                    [difficultyLevel]="currentQuestion.difficulty_level"
                    [showDetails]="true">
                </app-difficulty-indicator>
            </div>
            
            <div class="question-text" [innerHTML]="currentQuestion.content"></div>
            
            <div class="options-container">
                <div 
                    *ngFor="let option of currentQuestion.options; let i = index" 
                    class="option" 
                    [ngClass]="{
                        'selected': selectedOption === getOptionLetter(i),
                        'correct': showResult && option === currentQuestion.correct_answer,
                        'wrong': showResult && selectedOption === getOptionLetter(i) && option !== currentQuestion.correct_answer
                    }"
                    (click)="selectOption(getOptionLetter(i))"
                >
                    <span class="option-letter">{{ getOptionLetter(i) }}</span>
                    {{ option }}
                </div>
            </div>
            
            <!-- Hint Section -->
            <div class="hint-section" [class.show]="showHint">
                <h4>üí° ƒ∞pucu</h4>
                <div class="hint-text" [innerHTML]="currentQuestion.hint || 'Bu soru i√ßin ipucu bulunmuyor.'"></div>
            </div>
            
            <!-- Explanation Section -->
            <div class="explanation-section" [class.show]="showExplanation">
                <h4>‚úÖ A√ßƒ±klama</h4>
                <div class="explanation-text" [innerHTML]="currentQuestion.explanation || 'Bu soru i√ßin a√ßƒ±klama bulunmuyor.'"></div>
            </div>
            
            <!-- AI Feedback -->
            <div class="ai-feedback" [class.show]="showAIFeedback">
                <h4>ü§ñ AI Geri Bildirimi</h4>
                <div class="feedback-text" [innerHTML]="aiFeedbackText"></div>
            </div>
            
            <!-- Actions -->
            <div class="actions-section">
                <div style="display: flex; gap: 10px;">
                    <button 
                        class="btn" 
                        (click)="showHintSection()" 
                        [style.display]="showHint ? 'none' : 'block'"
                    >
                        üí° ƒ∞pucu Al
                    </button>
                    <button 
                        class="btn" 
                        (click)="showExplanationSection()" 
                        [style.display]="showExplanation ? 'none' : 'block'"
                    >
                        ‚úÖ A√ßƒ±klama
                    </button>
                    <button 
                        class="btn btn-primary" 
                        (click)="checkAnswer()" 
                        [disabled]="!selectedOption || isLoading"
                        [style.display]="showResult ? 'none' : 'block'"
                    >
                        {{ isLoading ? 'Kontrol Ediliyor...' : 'Cevabƒ± Kontrol Et' }}
                    </button>
                    <button 
                        class="btn btn-success" 
                        (click)="nextQuestion()" 
                        [style.display]="showResult ? 'block' : 'none'"
                    >
                        Sonraki Soru ‚Üí
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>Soru y√ºkleniyor...</p>
        </div>
        
        <!-- Quiz Complete Modal -->
        <div class="modal-overlay" *ngIf="showQuizComplete">
            <div class="modal-content">
                <h3>üéâ Quiz Tamamlandƒ±!</h3>
                <div class="quiz-results">
                    <div class="result-item">
                        <span class="result-label">Toplam Soru:</span>
                        <span class="result-value">{{ totalQuestions }}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Doƒüru Cevap:</span>
                        <span class="result-value correct">{{ correctAnswers }}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Yanlƒ±≈ü Cevap:</span>
                        <span class="result-value wrong">{{ wrongAnswers }}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Ba≈üarƒ± Oranƒ±:</span>
                        <span class="result-value">{{ accuracyPercentage }}%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Toplam S√ºre:</span>
                        <span class="result-value">{{ formatTime(elapsedTime) }}</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn" (click)="goBack()">Ana Sayfa</button>
                    <button class="btn btn-primary" (click)="restartQuiz()">Tekrar Ba≈üla</button>
                </div>
            </div>
        </div>
    </div>
</div>
